## IEEE 754

[TOC]

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4c2e995a18c4fe4ad2594723c79a626~tplv-k3u1fbpfcp-watermark.awebp)

`搞了2天终于弄懂了 指数部分, 尾数部分到底是啥意思了happy!` [Playground](https://jtr354.github.io/tdl-web-salary/src/365/ieee754/index.html)

## 我们是如何看时间的?

<img src=".\assets\clock.jpg" style="zoom:10%;" />

其实 IEEE 754 用来表示数字的方法跟,我们看时间的方法差不多. 请看上图, 现在是几点钟?

上过小学一年的你一定能够看出来是 10 点过 10 分. nice! 那么你是怎么看出来的呢?

首选 `短针` 在`第10个大格子`跟`第11个大格子` 之间, 所以, 你可以确定当前的时间是在 10 点 和 11 点之间,

如果你想要了解的更多, 就要去关注长针,

那么 就需要看 `长针` , 它指向的是`第2个大格子` ; 一个小时有 12 个大格子, 所以 2 格就是 `2/12=0.166666%`;

`2/12*60分钟=10分钟`; 所以你可以知道现在 10 点 10 分.

> 在 `IEEE 754` 中, 指数部分(exponent) 就相当于`短针`, 尾数部分(fraction) 就相当于`长针`

## IEEE 754 如何表示一个数

在 JavaScript 中 number 类型用 64 个 bit(8 个字节)存储, 其中

- 第一段占 1bit，表示符号位。代称为 S（sign）。
- 第二段占 11bits，表示指数。代称为 E（Exponent）。
- 第三段占 52bits，表示尾数。代称为 F（Fraction）。

然后小数的计算方式如下:

$$
(−1)^S*2^{E−1023}*(1+F/2^{52})
$$

这个公式看得我是一头雾水, 不知所云, 后来发现, 原来跟 钟表有异曲同工之妙!

### 我们先看看 3.14 是怎么表示的

![](.\assets\314.png)

- 第一段符号位。对于这一段，我相信应该没有人不能理解。

- 第二段是指数位。$2^1 < 3.14 < 2^2.$ 所以, n = 1, n + 1023 = 1024. 所以 E = 1024

  带入上述公式,我们能算出来; $2^{(1024 - 1023)} = 2^1$;`此时的短针在1和2之间; 如果要更加精确,则需长针的帮助`

- 第三段是尾数。$（3.14 - 2）/ (4 - 2) = 0.57$; 也就是说此时的 `长针` 走了 `57%` ; 所以$ F = 0.57\*2^{52} = 2567051787601182.5;$

​ `去掉小数部分就是 2567051787601182; 因为有四舍五入, 所有产生了浮点数据的精度问题。`

​ 带入公式:

​ $2^{1024−1023}\*(1+2567051787601182/2^{52}) $ = 2 + 1.1399999999999997 = 3.1399999999999997

> E = 1024 二进制表示 10000000000
>
> F = 2567051787601182 二进制表示: 1001000111101011100001010001111010111000010100011110

### 再来看看小于 1 的数 (0.015)

![](.\assets\0015.png)

- 是正数。所以，S = 0。

- $2^{-7}$<0.015<$2^-6$ 。所以，n = -7， n+1023 = 1016。所以，E=1016。

- (0.015 − $2^{-7}$) / ($2^{-6}$ − $2^{-7}$) = 0.0071875/0.0078125=0.92。

  而 0.92∗$2^{52}$=4143311657180856.5，四舍五入，得到 M = 4143311657180856。

## 小结

- 因为尾数只有 52 位所以, js 的最大安全整数是 Number.MAX_SAFE_INTEGER = $2^{53} - 1$
- 疑问: 64bit 等于 8 个字节, 为啥 大家都是数字只占 1 个字节?

## 参考

- [13 | 魔数 0x5f3759df](https://time.geekbang.org/column/article/730)
- [Day01 JS 整数是怎么表示的 | 面试打卡 365](https://juejin.cn/post/7048191028280426526#heading-7)

- [binaryconvert](http://www.binaryconvert.com/result_double.html?decimal=051046049052)
